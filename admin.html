<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Saint Ventura</title>
    <link rel="icon" type="image/png" href="https://dl.dropboxusercontent.com/scl/fi/pew6zj6bt0myobu7zl4eu/1-21.png?rlkey=z6jhjxe71rpuk37td9ktwvqmg&st=303hz8tw&dl=1">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="admin-refactored.js"></script>
    <script>
        // AdminApp is loaded from admin-refactored.js
        // All functions are exposed globally via AdminApp
        console.log('‚úÖ Admin dashboard loaded');
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            font-size: 16px;
            line-height: 1.5;
            box-sizing: border-box;
            overflow-x: hidden;
            background: #ffffff;
        }
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        /* Screen reader only class for accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        
        .sidebar-item {
            background-color: transparent;
            color: #000;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }
        .sidebar-item.active {
            background-color: transparent !important;
            color: #000 !important;
            border: 2px solid #000 !important;
            font-weight: 600;
        }
        .sidebar-item:hover:not(.active) {
            background-color: #f9fafb;
            transform: translateX(2px);
        }
        .sidebar-item.active:hover {
            background-color: transparent !important;
            color: #000 !important;
            border: 2px solid #000 !important;
        }
        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        .sidebar {
            transition: transform 0.3s ease, width 0.3s ease;
        }
        .sidebar.collapsed {
            width: 80px;
        }
        .sidebar.collapsed .sidebar-text {
            display: none;
        }
        .main-content {
            transition: margin-left 0.3s ease;
        }
        .stock-low {
            color: #ef4444;
            font-weight: bold;
        }
        .stock-medium {
            color: #f59e0b;
        }
        .stock-high {
            color: #10b981;
        }
        
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                z-index: 60 !important;
                transition: transform 0.3s ease;
            }
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0 !important;
            }
            .sidebar-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 55 !important;
            }
            .sidebar-overlay.active {
                display: block;
            }
            .inventory-table-mobile {
                display: block;
            }
            .inventory-table-desktop {
                display: none;
            }
        }
        
        @media (min-width: 769px) {
            .inventory-table-mobile {
                display: none;
            }
            .inventory-table-desktop {
                display: block;
            }
            .orders-table-mobile {
                display: none;
            }
            .orders-table-desktop {
                display: table;
            }
        }
        
        @media (max-width: 768px) {
            .inventory-table-desktop {
                display: none;
            }
            .inventory-table-mobile {
                display: block;
            }
            .orders-table-mobile {
                display: block;
            }
            .orders-table-desktop {
                display: none;
            }
        }
        
        .product-group {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .product-group:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .product-header {
            background: #f9fafb;
            padding: 1rem 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.2s ease;
        }
        
        .product-header:hover {
            background: #f3f4f6;
        }
        
        .product-header.expanded {
            background: #ffffff;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .product-variants {
            display: none;
            background: #ffffff;
        }
        
        .product-variants.show {
            display: block;
        }
        
        .variant-row {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #f3f4f6;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 1rem;
            align-items: center;
        }
        
        .variant-row:last-child {
            border-bottom: none;
        }
        
        @media (max-width: 768px) {
            .variant-row {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
        }
        
        .expand-icon {
            transition: transform 0.3s ease;
        }
        
        .expand-icon.expanded {
            transform: rotate(90deg);
        }
        
        .error-message {
            background: #fee;
            border: 1px solid #fcc;
            color: #c33;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #000;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="h-full bg-white text-black">
    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center bg-black">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold mb-2">Saint Ventura</h1>
                <p class="text-gray-600">Admin Dashboard</p>
            </div>
            <form id="login-form" class="space-y-4" onsubmit="return handleLogin(event);">
                <div>
                    <label class="block text-sm font-medium mb-2">Password</label>
                    <input type="password" id="admin-password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-black" placeholder="Enter admin password" required>
                </div>
                <button type="submit" class="w-full bg-black text-white py-3 rounded-lg font-semibold hover:bg-gray-800 transition">Login</button>
                <p id="login-error" class="text-red-500 text-sm text-center hidden"></p>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard" class="hidden min-h-screen">
        <!-- Header -->
        <header class="bg-white/95 backdrop-blur-md border-b border-gray-200 fixed top-0 left-0 right-0 z-[70]" style="z-index: 70 !important;">
            <div class="flex items-center justify-between px-4 md:px-6 py-4">
                <div class="flex items-center space-x-3 md:space-x-4">
                    <button onclick="toggleMobileSidebar()" class="md:hidden p-2 hover:bg-gray-100 rounded-lg" aria-label="Toggle mobile menu" title="Toggle mobile menu">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    <img src="https://dl.dropboxusercontent.com/scl/fi/pew6zj6bt0myobu7zl4eu/1-21.png?rlkey=z6jhjxe71rpuk37td9ktwvqmg&st=303hz8tw&dl=1" alt="SV Logo" class="w-10 h-10 md:w-12 md:h-12 rounded-lg object-cover" onerror="this.style.display='none'">
                    <h1 class="text-xl md:text-2xl font-bold">Saint Ventura Admin</h1>
                </div>
                <button onclick="logout()" class="px-3 md:px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition text-sm md:text-base">Logout</button>
            </div>
        </header>

        <!-- Mobile Sidebar Overlay -->
        <div id="sidebar-overlay" class="sidebar-overlay" onclick="closeMobileSidebar()" style="z-index: 55;"></div>

        <div class="flex pt-16">
            <!-- Sidebar -->
            <aside id="sidebar" class="sidebar w-64 bg-white border-r border-gray-200 min-h-screen fixed left-0 top-16 z-40 md:z-40 shadow-lg md:shadow-none" style="z-index: 60;">
                <div class="pt-6 pb-2 px-4">
                    <button onclick="toggleSidebar()" class="w-full flex items-center justify-between px-4 py-2 hover:bg-gray-100 rounded-lg transition">
                        <span class="font-semibold sidebar-text text-lg">Menu</span>
                        <svg id="sidebar-toggle-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15,18 9,12 15,6"></polyline>
                        </svg>
                    </button>
                </div>
                <nav class="px-4 pb-4 space-y-0 -mt-1" id="sidebar-nav">
                    <a href="#" onclick="event.preventDefault(); event.stopPropagation(); console.log('Dashboard clicked'); if(window.showSection) { window.showSection('dashboard'); } else { alert('showSection function not available'); } return false;" data-section="dashboard" class="sidebar-item flex items-center space-x-3 px-4 py-2 rounded-lg hover:bg-gray-100 transition cursor-pointer">
                        <span>üìä</span>
                        <span class="sidebar-text">Dashboard</span>
                    </a>
                    <a href="#" onclick="event.preventDefault(); event.stopPropagation(); console.log('Orders clicked'); if(window.showSection) { window.showSection('orders'); } else { alert('showSection function not available'); } return false;" data-section="orders" class="sidebar-item flex items-center space-x-3 px-4 py-2 rounded-lg hover:bg-gray-100 transition cursor-pointer">
                        <span>üìã</span>
                        <span class="sidebar-text">Orders</span>
                    </a>
                    <a href="#" onclick="event.preventDefault(); event.stopPropagation(); console.log('Inventory clicked'); if(window.showSection) { window.showSection('inventory'); } else { alert('showSection function not available'); } return false;" data-section="inventory" class="sidebar-item flex items-center space-x-3 px-4 py-2 rounded-lg hover:bg-gray-100 transition cursor-pointer">
                        <span>üì¶</span>
                        <span class="sidebar-text">Stock Inventory</span>
                    </a>
                    <a href="#" onclick="event.preventDefault(); event.stopPropagation(); console.log('Inbox clicked'); if(window.showSection) { window.showSection('inbox'); } else { alert('showSection function not available'); } return false;" data-section="inbox" class="sidebar-item flex items-center space-x-3 px-4 py-2 rounded-lg hover:bg-gray-100 transition relative cursor-pointer">
                        <span>üìß</span>
                        <span class="sidebar-text">Email Inbox</span>
                        <span id="inbox-badge" class="notification-badge hidden">0</span>
                    </a>
                    <a href="#" onclick="event.preventDefault(); event.stopPropagation(); console.log('Broadcast clicked'); if(window.showSection) { window.showSection('broadcast'); } else { alert('showSection function not available'); } return false;" data-section="broadcast" class="sidebar-item flex items-center space-x-3 px-4 py-2 rounded-lg hover:bg-gray-100 transition cursor-pointer">
                        <span>üì¢</span>
                        <span class="sidebar-text">Broadcast</span>
                    </a>
                    <a href="#" onclick="event.preventDefault(); event.stopPropagation(); console.log('Abandoned Carts clicked'); if(window.showSection) { window.showSection('abandoned-carts'); } else { alert('showSection function not available'); } return false;" data-section="abandoned-carts" class="sidebar-item flex items-center space-x-3 px-4 py-2 rounded-lg hover:bg-gray-100 transition relative cursor-pointer">
                        <span>üõí</span>
                        <span class="sidebar-text">Abandoned Carts</span>
                        <span id="carts-badge" class="notification-badge hidden">0</span>
                    </a>
                    <a href="#" onclick="event.preventDefault(); event.stopPropagation(); console.log('Fulfillers clicked'); if(window.showSection) { window.showSection('fulfillers'); } else { alert('showSection function not available'); } return false;" data-section="fulfillers" class="sidebar-item flex items-center space-x-3 px-4 py-2 rounded-lg hover:bg-gray-100 transition cursor-pointer">
                        <span>üë•</span>
                        <span class="sidebar-text">Order Fulfillers</span>
                    </a>
                    <a href="#" onclick="event.preventDefault(); event.stopPropagation(); console.log('Notifications clicked'); if(window.showSection) { window.showSection('notifications'); } else { alert('showSection function not available'); } return false;" data-section="notifications" class="sidebar-item flex items-center space-x-3 px-4 py-2 rounded-lg hover:bg-gray-100 transition relative cursor-pointer">
                        <span>üîî</span>
                        <span class="sidebar-text">Notifications</span>
                        <span id="notifications-badge" class="notification-badge hidden">0</span>
                    </a>
                    <a href="#" onclick="event.preventDefault(); event.stopPropagation(); console.log('Sales clicked'); if(window.showSection) { window.showSection('sales'); } else { alert('showSection function not available'); } return false;" data-section="sales" class="sidebar-item flex items-center space-x-3 px-4 py-2 rounded-lg hover:bg-gray-100 transition cursor-pointer">
                        <span>üí∞</span>
                        <span class="sidebar-text">Sale Dashboard</span>
                    </a>
                    <a href="#" onclick="event.preventDefault(); event.stopPropagation(); console.log('Analytics clicked'); if(window.showSection) { window.showSection('analytics'); } else { alert('showSection function not available'); } return false;" data-section="analytics" class="sidebar-item flex items-center space-x-3 px-4 py-2 rounded-lg hover:bg-gray-100 transition cursor-pointer">
                        <span>üìà</span>
                        <span class="sidebar-text">Analytics</span>
                    </a>
                </nav>
            </aside>

            <!-- Main Content -->
            <main id="main-content" class="main-content flex-1 ml-0 md:ml-64 p-6 md:p-8 lg:p-10 bg-white">
                <!-- Dashboard Overview Section -->
                <div id="dashboard-section" class="section">
                    <h2 class="text-2xl md:text-3xl font-bold mb-8">Dashboard Overview</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8 mb-8">
                        <div class="bg-gradient-to-br from-white to-gray-50 border border-gray-200 rounded-xl p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <p class="text-sm md:text-base text-gray-600 font-medium">Total Revenue</p>
                                <span class="text-2xl md:text-3xl">üí∞</span>
                            </div>
                            <p id="stat-total-revenue" class="text-2xl md:text-3xl font-bold text-black">R0.00</p>
                        </div>
                        <div class="bg-gradient-to-br from-white to-gray-50 border border-gray-200 rounded-xl p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <p class="text-sm md:text-base text-gray-600 font-medium">Total Profit</p>
                                <span class="text-2xl md:text-3xl">üìà</span>
                            </div>
                            <p id="stat-total-profit" class="text-2xl md:text-3xl font-bold text-green-600">R0.00</p>
                        </div>
                        <div class="bg-gradient-to-br from-white to-gray-50 border border-gray-200 rounded-xl p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <p class="text-sm md:text-base text-gray-600 font-medium">Completed Orders</p>
                                <span class="text-2xl md:text-3xl">üìã</span>
                            </div>
                            <p id="stat-total-orders" class="text-2xl md:text-3xl font-bold text-black">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-white to-gray-50 border border-gray-200 rounded-xl p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <p class="text-sm md:text-base text-gray-600 font-medium">Pending Orders</p>
                                <span class="text-2xl md:text-3xl">‚è≥</span>
                            </div>
                            <p id="stat-pending-orders" class="text-2xl md:text-3xl font-bold text-black">0</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8 mb-8">
                        <div class="bg-gradient-to-br from-white to-gray-50 border border-gray-200 rounded-xl p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <p class="text-sm md:text-base text-gray-600 font-medium">Subscribers</p>
                                <span class="text-2xl md:text-3xl">üë•</span>
                            </div>
                            <p id="stat-subscribers" class="text-2xl md:text-3xl font-bold text-black">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-white to-gray-50 border border-gray-200 rounded-xl p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <p class="text-sm md:text-base text-gray-600 font-medium">Low Stock Items</p>
                                <span class="text-2xl md:text-3xl">‚ö†Ô∏è</span>
                            </div>
                            <p id="stat-low-stock" class="text-2xl md:text-3xl font-bold text-red-600">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-white to-gray-50 border border-gray-200 rounded-xl p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <p class="text-sm md:text-base text-gray-600 font-medium">Unread Notifications</p>
                                <span class="text-2xl md:text-3xl">üîî</span>
                            </div>
                            <p id="stat-notifications" class="text-2xl md:text-3xl font-bold text-black">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-white to-gray-50 border border-gray-200 rounded-xl p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <p class="text-sm md:text-base text-gray-600 font-medium">Unread Emails</p>
                                <span class="text-2xl md:text-3xl">üìß</span>
                            </div>
                            <p id="stat-emails" class="text-2xl md:text-3xl font-bold text-black">0</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8 mb-8">
                        <div class="bg-gradient-to-br from-white to-gray-50 border border-gray-200 rounded-xl p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <p class="text-sm md:text-base text-gray-600 font-medium">Abandoned Carts</p>
                                <span class="text-2xl md:text-3xl">üõí</span>
                            </div>
                            <p id="stat-carts" class="text-2xl md:text-3xl font-bold text-black">0</p>
                        </div>
                    </div>
                    <div class="bg-white border border-gray-200 rounded-lg p-6 md:p-8 shadow-sm mt-8">
                        <h3 class="text-xl md:text-2xl font-semibold mb-6">Recent Orders</h3>
                        <div id="recent-orders-list" class="space-y-4">
                            <div class="text-center py-8 text-gray-500">Loading recent orders...</div>
                        </div>
                    </div>
                </div>

                <!-- Orders Management Section -->
                <div id="orders-section" class="section hidden">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 space-y-4 md:space-y-0">
                        <h2 class="text-2xl md:text-3xl font-bold">Orders Management</h2>
                        <button onclick="refreshOrders()" class="w-full md:w-auto px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 flex items-center justify-center space-x-2">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23,4 23,10 17,10"></polyline>
                                <polyline points="1,20 1,14 7,14"></polyline>
                                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                            </svg>
                            <span>Refresh</span>
                        </button>
                    </div>
                    <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex flex-col md:flex-row items-stretch md:items-center space-y-4 md:space-y-0 md:space-x-6">
                                <input type="text" id="orders-search" placeholder="Search orders..." class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-black">
                                <label for="orders-filter-status" class="sr-only">Filter orders by status</label>
                                <select id="orders-filter-status" name="orders-filter-status" title="Filter orders by status" aria-label="Filter orders by status" class="w-full md:w-auto px-4 py-2 border border-gray-300 rounded-lg">
                                    <option value="">All Status</option>
                                    <option value="pending checkout">Pending Checkout</option>
                                    <option value="pending fulfillment">Pending Fulfillment</option>
                                    <option value="fulfilled">Fulfilled</option>
                                </select>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <!-- Desktop Table -->
                            <table class="w-full orders-table-desktop">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="text-left py-4 px-4 md:px-6 font-semibold text-gray-700 text-sm md:text-base">Order ID</th>
                                        <th class="text-left py-4 px-4 md:px-6 font-semibold text-gray-700 text-sm md:text-base">Customer</th>
                                        <th class="text-left py-4 px-4 md:px-6 font-semibold text-gray-700 text-sm md:text-base">Items</th>
                                        <th class="text-left py-4 px-4 md:px-6 font-semibold text-gray-700 text-sm md:text-base">Total</th>
                                        <th class="text-left py-4 px-4 md:px-6 font-semibold text-gray-700 text-sm md:text-base">Delivery Cost</th>
                                        <th class="text-left py-4 px-4 md:px-6 font-semibold text-gray-700 text-sm md:text-base">Status</th>
                                        <th class="text-left py-4 px-4 md:px-6 font-semibold text-gray-700 text-sm md:text-base">Date</th>
                                        <th class="text-left py-4 px-4 md:px-6 font-semibold text-gray-700 text-sm md:text-base">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="orders-table" class="divide-y divide-gray-200">
                                    <tr><td colspan="8" class="text-center py-12 text-gray-500">
                                        <div class="flex items-center justify-center space-x-2">
                                            <div class="loading-spinner"></div>
                                            <span>Loading orders...</span>
                                        </div>
                                    </td></tr>
                                </tbody>
                            </table>
                            
                            <!-- Mobile Cards -->
                            <div id="orders-table-mobile" class="orders-table-mobile space-y-6 p-6">
                                <div class="text-center py-8 text-gray-500">
                                    <div class="flex items-center justify-center space-x-2">
                                        <div class="loading-spinner"></div>
                                        <span>Loading orders...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Section -->
                <div id="analytics-section" class="section hidden">
                    <h2 class="text-2xl md:text-3xl font-bold mb-8">Analytics & Reports</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="bg-white border border-gray-200 rounded-lg p-6 md:p-8 shadow-sm">
                            <h3 class="text-xl md:text-2xl font-semibold mb-6">Monthly Revenue</h3>
                            <div id="revenue-chart" class="h-64 flex items-center justify-center text-gray-500">
                                <div class="text-center">
                                    <div class="loading-spinner mx-auto mb-2"></div>
                                    <p>Loading revenue data...</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white border border-gray-200 rounded-lg p-6 md:p-8 shadow-sm">
                            <h3 class="text-xl md:text-2xl font-semibold mb-6">Order Status Distribution</h3>
                            <div id="status-chart" class="h-64 flex items-center justify-center text-gray-500">
                                <div class="text-center">
                                    <div class="loading-spinner mx-auto mb-2"></div>
                                    <p>Loading status data...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white border border-gray-200 rounded-lg p-6 md:p-8 shadow-sm">
                        <h3 class="text-xl md:text-2xl font-semibold mb-6">Sales Summary</h3>
                        <div id="sales-summary" class="space-y-4">
                            <div class="text-center py-8 text-gray-500">Loading sales summary...</div>
                        </div>
                    </div>
                </div>

                <!-- Stock Inventory Section -->
                <div id="inventory-section" class="section hidden">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 space-y-4 md:space-y-0">
                        <h2 class="text-2xl md:text-3xl font-bold">Stock Inventory</h2>
                        <button onclick="if(typeof window.refreshInventory==='function')window.refreshInventory()" class="w-full md:w-auto px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 flex items-center justify-center space-x-2">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23,4 23,10 17,10"></polyline>
                                <polyline points="1,20 1,14 7,14"></polyline>
                                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                            </svg>
                            <span>Refresh</span>
                        </button>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg border border-gray-200">
                        <div class="p-6 md:p-8 border-b border-gray-200">
                            <div class="flex flex-col md:flex-row items-stretch md:items-center space-y-4 md:space-y-0 md:space-x-6">
                                <div class="flex-1">
                                    <input type="text" id="inventory-search" placeholder="Search products, variants..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-black text-sm md:text-base">
                                </div>
                                <label for="inventory-filter-category" class="sr-only">Filter inventory by category</label>
                                <select id="inventory-filter-category" name="inventory-filter-category" title="Filter inventory by category" aria-label="Filter inventory by category" class="w-full md:w-auto px-4 py-2 border border-gray-300 rounded-lg text-sm md:text-base">
                                    <option value="">All Categories</option>
                                    <option value="tops">Tops</option>
                                    <option value="bottoms">Bottoms</option>
                                    <option value="accessories">Accessories</option>
                                </select>
                            </div>
                        </div>
                        <div class="p-6">
                            <!-- Desktop Product Tree -->
                            <div id="inventory-table" class="inventory-table-desktop space-y-4">
                                <div class="text-center py-12 text-gray-500">
                                    <div class="flex items-center justify-center space-x-2">
                                        <div class="loading-spinner"></div>
                                        <span>Loading inventory...</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Mobile Product Tree -->
                            <div id="inventory-table-mobile" class="inventory-table-mobile space-y-4">
                                <div class="text-center py-8 text-gray-500">
                                    <div class="flex items-center justify-center space-x-2">
                                        <div class="loading-spinner"></div>
                                        <span>Loading inventory...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Email Inbox Section -->
                <div id="inbox-section" class="section hidden">
                    <h2 class="text-2xl md:text-3xl font-bold mb-8">Email Inbox</h2>
                    <div class="bg-white rounded-lg shadow p-6 md:p-8">
                        <div class="mb-6 flex flex-col md:flex-row justify-between items-stretch md:items-center space-y-4 md:space-y-0 md:space-x-6">
                            <input type="text" id="inbox-search" placeholder="Search emails..." class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm md:text-base">
                            <div class="flex space-x-2">
                                <button onclick="if(typeof window.showComposeEmail==='function')window.showComposeEmail()" class="w-full md:w-auto px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm md:text-base font-medium">Compose</button>
                                <button onclick="fetchEmails()" class="w-full md:w-auto px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm md:text-base">Fetch Emails</button>
                                <button onclick="if(typeof window.refreshInbox==='function')window.refreshInbox()" class="w-full md:w-auto px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 text-sm md:text-base">Refresh</button>
                            </div>
                        </div>
                        <div id="inbox-list" class="space-y-4">
                            <div class="text-center py-8 text-gray-500">Loading emails...</div>
                        </div>
                    </div>
                </div>

                <!-- Broadcast Section -->
                <div id="broadcast-section" class="section hidden">
                    <div class="mb-8">
                        <h2 class="text-2xl md:text-3xl font-bold mb-2">Email Broadcast</h2>
                        <p class="text-gray-600">Send newsletters, promotions, and updates to all subscribers</p>
                            </div>
                    <div class="bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-lg border border-gray-100 p-6 md:p-8 mb-8">
                        <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-6">
                                <div>
                                <h3 class="text-xl md:text-2xl font-semibold mb-2">Subscriber Overview</h3>
                                <p class="text-gray-600">Total Subscribers: <span id="subscriber-count" class="font-bold text-black text-lg">0</span></p>
                                </div>
                            <button onclick="if(typeof window.openBroadcastEmailComposer==='function')window.openBroadcastEmailComposer()" class="mt-4 md:mt-0 w-full md:w-auto px-6 py-3 bg-black text-white rounded-xl font-semibold hover:bg-gray-800 transition shadow-md hover:shadow-lg">
                                ‚úâÔ∏è Compose Broadcast Email
                            </button>
                        </div>
                        <div class="bg-white rounded-xl border border-gray-200 p-4 max-h-96 overflow-y-auto mb-4">
                            <div id="subscribers-list" class="space-y-2">
                                <div class="text-center py-4 text-gray-500">Loading subscribers...</div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl border border-gray-200 p-4">
                            <h4 class="text-lg font-semibold mb-4">Add New Subscriber</h4>
                            <form id="add-subscriber-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Email Address</label>
                                    <input type="email" id="new-subscriber-email" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required placeholder="subscriber@example.com">
                                </div>
                                <button type="submit" class="w-full px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 font-medium">Add Subscriber</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Abandoned Carts Section -->
                <div id="abandoned-carts-section" class="section hidden">
                    <h2 class="text-2xl md:text-3xl font-bold mb-8">Abandoned Carts</h2>
                    <div class="bg-white rounded-lg shadow p-6 md:p-8">
                        <div class="mb-6 flex flex-col md:flex-row justify-between items-stretch md:items-center space-y-4 md:space-y-0 md:space-x-6">
                            <button onclick="if(typeof window.openAbandonedCartEmailComposer==='function')window.openAbandonedCartEmailComposer()" class="w-full md:w-auto px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm md:text-base">Compose Reminder Email</button>
                            <button onclick="if(typeof window.refreshAbandonedCarts==='function')window.refreshAbandonedCarts()" class="w-full md:w-auto px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 text-sm md:text-base">Refresh</button>
                        </div>
                        <div id="abandoned-carts-list" class="space-y-6">
                            <div class="text-center py-8 text-gray-500">Loading abandoned carts...</div>
                        </div>
                    </div>
                </div>

                <!-- Order Fulfillers Section -->
                <div id="fulfillers-section" class="section hidden">
                    <h2 class="text-2xl md:text-3xl font-bold mb-8">Order Fulfillers</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="bg-white rounded-lg shadow p-6 md:p-8">
                            <h3 class="text-xl md:text-2xl font-semibold mb-6">Fulfiller List</h3>
                            <div class="mb-6">
                                <button onclick="showAddFulfillerModal()" class="px-6 py-3 bg-black text-white rounded-lg hover:bg-gray-800 font-medium">Add Fulfiller</button>
                            </div>
                            <div id="fulfillers-list" class="space-y-4">
                                <div class="text-center py-4 text-gray-500">Loading fulfillers...</div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6 md:p-8">
                            <h3 class="text-xl md:text-2xl font-semibold mb-6">Send Order Notification</h3>
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Select Fulfiller</label>
                                    <select id="fulfiller-select" name="fulfiller-select" title="Select a fulfiller" aria-label="Select a fulfiller" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                        <option value="">Select a fulfiller...</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Select Order (Pending Fulfillment or Fulfilled)</label>
                                    <select id="fulfiller-order-select" name="fulfiller-order-select" title="Select an order" aria-label="Select an order to fulfill" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                        <option value="">Select an order...</option>
                                    </select>
                                </div>
                                <button onclick="if(typeof window.openFulfillerEmailComposer==='function')window.openFulfillerEmailComposer()" class="w-full bg-black text-white py-3 rounded-lg font-semibold hover:bg-gray-800 transition">Compose Email to Fulfiller</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notifications Section -->
                <div id="notifications-section" class="section hidden">
                    <h2 class="text-2xl md:text-3xl font-bold mb-8">Website Notifications</h2>
                    <div class="bg-white rounded-lg shadow p-6 md:p-8">
                        <div class="mb-6 flex flex-col md:flex-row justify-between items-stretch md:items-center space-y-4 md:space-y-0 md:space-x-6">
                            <button onclick="if(typeof window.markAllRead==='function')window.markAllRead()" class="w-full md:w-auto px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 text-sm md:text-base">Mark All as Read</button>
                            <button onclick="if(typeof window.refreshNotifications==='function')window.refreshNotifications()" class="w-full md:w-auto px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 text-sm md:text-base">Refresh</button>
                        </div>
                        <div id="notifications-list" class="space-y-4">
                            <div class="text-center py-8 text-gray-500">Loading notifications...</div>
                        </div>
                    </div>
                </div>

                <!-- Sale Dashboard Section -->
                <div id="sales-section" class="section hidden">
                    <h2 class="text-2xl md:text-3xl font-bold mb-8">Point of Sale</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2 bg-white rounded-lg shadow p-6 md:p-8">
                            <h3 class="text-xl md:text-2xl font-semibold mb-6">Create Order</h3>
                            <div class="mb-6">
                                <input type="text" id="pos-search" placeholder="Search products..." class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                            </div>
                            <div id="pos-products" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-8">
                                <!-- Products will be loaded here -->
                            </div>
                            <div class="border-t pt-6">
                                <h4 class="font-semibold text-lg mb-4">Order Items</h4>
                                <div id="pos-cart" class="space-y-4 mb-6">
                                    <p class="text-gray-500 text-sm">No items added</p>
                                </div>
                                <div class="flex justify-between font-bold text-lg">
                                    <span>Total:</span>
                                    <span id="pos-total">R0.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6 md:p-8">
                            <h3 class="text-xl md:text-2xl font-semibold mb-6">Customer Details</h3>
                            <form id="pos-order-form" class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Customer Name</label>
                                    <input type="text" id="pos-customer-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Email</label>
                                    <input type="email" id="pos-customer-email" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Phone</label>
                                    <input type="tel" id="pos-customer-phone" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Payment Method</label>
                                    <select id="pos-payment-method" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                        <option value="yoco">Yoco Payment</option>
                                        <option value="cash">Cash</option>
                                        <option value="eft">EFT</option>
                                    </select>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="pos-subscribe" class="w-4 h-4 border border-gray-300 rounded text-black focus:ring-black">
                                    <label for="pos-subscribe" class="ml-2 text-sm font-medium">Subscribe to newsletter</label>
                                </div>
                                <button type="submit" class="w-full bg-black text-white py-3 rounded-lg font-semibold hover:bg-gray-800 transition">Process Order</button>
                            </form>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Compose Email Modal -->
    <div id="compose-email-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4" style="padding-top: 2rem;">
        <div class="bg-white rounded-lg p-6 w-full max-w-5xl max-h-[90vh] overflow-y-auto shadow-2xl" style="margin-top: 0;">
            <div class="flex justify-between items-center mb-4 sticky top-0 bg-white pb-4 border-b">
                <h3 class="text-xl font-semibold">Compose Email</h3>
                <button onclick="closeComposeEmail()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="compose-email-form" class="space-y-4">
                <!-- Email Template Selection -->
                <div id="email-template-section" class="hidden">
                    <label class="block text-sm font-medium mb-2">Email Template</label>
                    <select id="email-template-select" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-black" onchange="loadEmailTemplate()">
                        <option value="">Select a template...</option>
                        <optgroup label="Broadcast Templates">
                            <option value="promotion">Promotion / Sale</option>
                            <option value="new-product">New Product Launch</option>
                            <option value="news">News / Update</option>
                        </optgroup>
                        <optgroup label="Fulfiller Templates">
                            <option value="fulfiller-order">Completed Order Notification</option>
                        </optgroup>
                    </select>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">To <span class="text-gray-500 text-xs">(comma-separated for multiple)</span></label>
                        <textarea id="compose-to" class="w-full px-4 py-2 border border-gray-300 rounded-lg min-h-[60px] resize-y" required placeholder="recipient@example.com or recipient1@example.com, recipient2@example.com"></textarea>
                        <button type="button" onclick="addAllSubscribers()" id="add-subscribers-btn" class="hidden mt-2 text-xs text-blue-600 hover:text-blue-800 underline">Add All Subscribers</button>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Subject</label>
                        <label for="compose-subject" class="block text-sm font-medium mb-2">Subject</label>
                        <input type="text" id="compose-subject" name="compose-subject" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required placeholder="Email subject">
                    </div>
                </div>
                
                <!-- Email Builder Toolbar -->
                <div class="border border-gray-300 rounded-lg p-3 bg-gray-50">
                    <p class="text-sm font-medium mb-2">Add Section:</p>
                    <div class="flex flex-wrap gap-2">
                        <button type="button" onclick="addEmailSection('text')" class="px-3 py-1 bg-white border border-gray-300 rounded text-sm hover:bg-gray-100">Text</button>
                        <button type="button" onclick="addEmailSection('heading')" class="px-3 py-1 bg-white border border-gray-300 rounded text-sm hover:bg-gray-100">Heading</button>
                        <button type="button" onclick="addEmailSection('image')" class="px-3 py-1 bg-white border border-gray-300 rounded text-sm hover:bg-gray-100">Image</button>
                        <button type="button" onclick="addEmailSection('button')" class="px-3 py-1 bg-white border border-gray-300 rounded text-sm hover:bg-gray-100">Button</button>
                        <button type="button" onclick="addEmailSection('divider')" class="px-3 py-1 bg-white border border-gray-300 rounded text-sm hover:bg-gray-100">Divider</button>
                        <button type="button" onclick="addEmailSection('spacer')" class="px-3 py-1 bg-white border border-gray-300 rounded text-sm hover:bg-gray-100">Spacer</button>
                    </div>
                </div>
                
                <!-- Email Builder Canvas -->
                <div>
                    <label class="block text-sm font-medium mb-2">Email Content</label>
                    <div id="email-builder" class="border border-gray-300 rounded-lg p-4 min-h-[400px] bg-white space-y-4">
                        <div class="email-section" data-type="text">
                            <div class="flex justify-between items-center mb-2">
                                <label for="email-builder-text-dynamic" class="text-xs text-gray-500 font-medium">Text Section</label>
                                <button type="button" onclick="removeEmailSection(this)" class="text-red-500 text-xs hover:text-red-700">Remove</button>
                            </div>
                            <textarea id="email-builder-text-dynamic" name="email-builder-text-dynamic" class="w-full px-3 py-2 border border-gray-200 rounded text-sm" rows="3" placeholder="Enter text content..."></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- Preview Toggle -->
                <div class="flex items-center space-x-2">
                    <input type="checkbox" id="preview-mode" onchange="toggleEmailPreview()" class="rounded">
                    <label for="preview-mode" class="text-sm">Preview Mode</label>
                </div>
                
                <div class="flex space-x-2 sticky bottom-0 bg-white pt-4 border-t">
                    <button type="submit" class="flex-1 bg-black text-white py-2 rounded-lg hover:bg-gray-800 font-medium">Send</button>
                    <button type="button" onclick="closeComposeEmail()" class="flex-1 bg-gray-300 text-black py-2 rounded-lg hover:bg-gray-400">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View/Reply Email Modal -->
    <div id="view-email-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4" style="padding-top: 2rem;">
        <div class="bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-2xl" style="margin-top: 0;">
            <div class="flex justify-between items-center mb-4 sticky top-0 bg-white pb-4 border-b">
                <h3 class="text-xl font-semibold" id="view-email-subject">Email</h3>
                <button onclick="closeViewEmail()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <div class="space-y-4">
                <div>
                    <p class="text-sm text-gray-600">From: <span id="view-email-from" class="font-medium"></span></p>
                    <p class="text-sm text-gray-600">Date: <span id="view-email-date" class="font-medium"></span></p>
                </div>
                <div class="border-t pt-4">
                    <div id="view-email-body" class="email-content-container"></div>
                </div>
                <div class="flex space-x-2 pt-4 border-t sticky bottom-0 bg-white">
                    <button onclick="replyToEmail()" class="flex-1 bg-black text-white py-2 rounded-lg hover:bg-gray-800 font-medium">Reply</button>
                    <button onclick="deleteEmail()" class="flex-1 bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 font-medium">Delete</button>
                    <button onclick="closeViewEmail()" class="flex-1 bg-gray-300 text-black py-2 rounded-lg hover:bg-gray-400">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Fulfiller Modal -->
    <div id="add-fulfiller-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <h3 class="text-xl font-semibold mb-4">Add Order Fulfiller</h3>
            <form id="add-fulfiller-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Name</label>
                    <input type="text" id="fulfiller-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Email</label>
                    <input type="email" id="fulfiller-email" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Phone</label>
                    <input type="tel" id="fulfiller-phone" class="w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                </div>
                <div class="flex space-x-2">
                    <button type="submit" class="flex-1 bg-black text-white py-2 rounded-lg hover:bg-gray-800">Add</button>
                    <button type="button" onclick="closeAddFulfillerModal()" class="flex-1 bg-gray-300 text-black py-2 rounded-lg hover:bg-gray-400">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // All admin functionality is loaded from admin-refactored.js
        // No hardcoded passwords - authentication handled via API
        console.log('‚úÖ Admin dashboard body script loaded');
        
        // Initialize helper functions that need to be in body script
        // (functions that interact with DOM elements that may not exist in head)
        
        // Setup sidebar navigation - attach event listeners to sidebar items
        function setupSidebarNavigation() {
            const sidebarItems = document.querySelectorAll('[data-section]');
            sidebarItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const section = this.getAttribute('data-section');
                    if (section && typeof window.showSection === 'function') {
                        window.showSection(section);
                    }
                });
            });
        }
        
        // Initialize on DOM ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setupSidebarNavigation();
            });
        } else {
            setupSidebarNavigation();
        }
    </script>
</body>
</html>